# CupTaster 

CupTaster - бесплатное приложения для барист, продавцов и кофеманов, которые занимаются профессиональной дегустацией кофе.

Приложение, которое скоро появится в AppStore, актуально в современном кофейном мире и не имеет других бесплатных или локализованных на русский язык аналогов.

# Установка

Системные требования: iOS 15+
Приложение доступно [по ссылке](https://testflight.apple.com/join/MXIWp90i) в TestFlight.

![tf qr](https://user-images.githubusercontent.com/101638182/204143843-032233bf-5cd2-4475-8b53-4c5322d23823.png)

# Суть в кратце

Каппинг (cup-testing) - процесс дегустации кофе.

Дегустацию кофе проводят для оценки качества продукции при закупке и для присуждения кофе категории "specialty". Бариста посещают каппинги, чтобы понять, как лучше работать с тем или иным сортом. Любители кофе могут участвуют в каппингах для того, чтобы лучше разбираться в сортах и вкусах. Люди, заинтересованные в кофе, регулярно ходят на каппинги. 

На этих мероприятиях подгатавливается несколько образцов для дегустации и расставляются чашки (от 1 до 5) рядом с каждым образцом. Затем открываются образцы, настраивается помол и т.д. в соответствии с выбранным протоколом для каппинга (у каждой формы для каппинга свой протокол). После образцы оцениваются по выбранной форме для каппинга.

Протоколы тоже скоро будут добавлены в приложение в виде подсказок, чтобы люди, которые только начали ходить на каппинги, смогли разобраться в непонятных терминах и присвоить правильное значние для каждого критерия оценки во время процесса дегустации. Сам код уже написан и присутсвует в коде, но подсказки еще не написаны.

Само приложение нужно для записи и хранения каппингов. Пока предстоит еще много работы, но в приоритете - сделать его удобнее, чем каппинг на бумаге и продуктивнее, чем записи в заметках, а самое главное добавить русскую локализацию.

# Основные экраны 

Основная цепочка пользования приложением состоит из двух событий:
1. Создание нового каппинга и заполнение его параметров, которые после можно изменить (название, кол-во образцов, кол-во чашек на один образец и форма для каппинга)
2. Заполнение всех полей формы для каппинга

Вся указанная информация отображается на разных экранах, а для того чтобы было удобнее анализировать свои записи была добавлена лепестковая диаграмма.
Для удобного переключения между образцами или выхода из режима просмотра и редактирования можно использовать свайпы как в браузере.
Ниже можно увидеть как все это выглядит в приложении:

![app preview](https://user-images.githubusercontent.com/101638182/204294792-39b50c90-d121-4847-9822-373cf6f176a9.png)

Заполнять критерии оценки можно с помощью пяти различных способов ввода:

1. Slider - выбор одного из значений drag жестом
2. Radio - выбор одного из значений нажатием
3. Checkboxes "Cups" - выбор нескольких значений на основе кол-ва чашек
4. MultiplePicker - выбор нескольких значений с помощью всплывающего окна (кол-во значений может быть основано на кол-ве чашек)

![QCs](https://user-images.githubusercontent.com/101638182/204142126-fe6a349a-27d9-4eb9-a796-6a2371a69bb5.jpg)

# Core Data

В приложении используется CoreData для хранения и записи данных о проведенных каппингах.

Основные сущности:

- Cupping - хранит в себе информацию о событии, а так же образцы.
- CuppingForm - хранит информацию о добаленных формах для каппинга.
- Sample - информация об образце, которая заполняется на основе несколких чашек одного сорта кофе.
- QCGroup (quality criteria group) - группа критериев оценки зерна, которая ссылается на конфигурацию, хранящую название и порядковый номер.
- QualityCriterua - критерий оценки зерна, который ссылается на конфигурацию с 

Ниже можно посмотреть на все сущности базы данных и их зависимости друг от друга:

![CupTaster DB](https://user-images.githubusercontent.com/101638182/203571054-a2008333-9a19-4d67-a9b6-13754e3e6b4a.png)

# Содержание папок и файлов

* [ContentView](CupTaster/ContentView.swift) - Tab Bar со всеми страницами приложения, а так же modifier для отображения Onboarding, в случае, если приложение было запущено впервые.
* [Tester](CupTaster/Tester.swift) -Страница почти пустая, написана для тестирования и отображается в TabBar только если нажать на версию приложения 10 раз в настройках.

## [Onboarding](CupTaster/Onboarding)
Это modifier, который применяется ко всему приложению. Его задача - отображать sheet в случае, если приложения запущено впервые. Он необходим для того, 
добавить необходимые пользователю формы для каппинга в базу данных. Так как невозможно предустановить добавление сущностей в хранилище при установке приложения, то делается это вручную пользователем. Он так же показывает приветствие и главные функции приложения.

* [ViewModifier](CupTaster/Onboarding/ViewModifier.swift) - modifier, который применятеся ко всему приложению 
* [Onboarding](CupTaster/Onboarding/Onboarding.swift) - экран, который отображается в modifier'е с приветствием и выбором форм для каппинга.
* [Onboarding Features](CupTaster/Onboarding/Onboarding%20Features.swift) - основные функции приложения, показываются перед выбором форм для каппинга

***Почему формы для каппинга хранятся как объекты в базе данных, если пользователь никак не может с ними взаимодействовать?***

Так как ассоциации specialty кофе иногда меняют свои формы для каппинга, то эти формы придется обновить, так, чтобы остались предыдущие записи. В таком случае в настройках появится новая версия формы, а старая будет считаться deprecated (устаревшей). Так можно будет добавлять записи с новой формой, а старые не удалятся.
Форм много и добавлены только 3 самые популярные. В будущем их станет больше, поэтому проще добавлять только нужные и каждую по отдельности в базу данных, конвертирововав из JSON файлов в папке [Cupping Forms](/CupTaster/Cupping%20Forms)

## [Cupping](CupTaster/Cupping)

* [Cupping Tab](CupTaster/Cupping/Cupping%20Tab.swift) - list со всеми записанными каппингами и функцией добавления нового каппинга.
* [Cupping](CupTaster/Cupping/Cupping.swift) - сетка просмотра preview всех добавленных в каппинг образцов.
* [Cupping Model](CupTaster/Cupping/Cupping%20Model.swift) - модель каппинга в которой содержится актуальная информация о каппинге, а так же выбранный образец и способ его отображения (General Info / Quality Criteria, как на скриншотах приложения). В этой же модели хранится и информация о жестах для toolbar'а образцов и самого каппинга, поскольку он един для этих страниц.
* [Cupping Settings](CupTaster/Cupping/Cupping%20Settings.swift) - sheet с первоначальной настройкой каппинга.
* [Cupping Toolbar](CupTaster/Cupping/Cupping%20Toolbar.swift) - toolbar со всеми инструментами для работы как с каппингом, так и с открытми образцами.

## [Sample](CupTaster/Sample)
В этой папке хранятся:
* [Sample](CupTaster/Sample/Sample.swift) - Один из двух вариантов отображения образца (General Info / Quality Criteria, как на скриншотах приложения) в зависимости от указанного атрибута appearance при инициализации.
* [Sample Selector](CupTaster/Sample/Sample%20Selector.swift) - Смещает образцы так, чтобы на экране отобржался только выбранный образец. Нужен для работы с жестами. Нуждается в серьезной доработке, поскольку если образцов слишком много (что большая редкость), то начинает зависать, но на первое время сойдет.
* [Sample Selector Tools](CupTaster/Sample/Sample%20Selector%20Tools.swift) - Инструменты для работы с выбранным образцом.
* [Sample Hints Menu](CupTaster/Sample/Sample%20Hints%20Menu.swift) - На данный момент отсутствует в приложении, поскольку подсказки еще не написаны, но работает. Отображает поверх образца подсказки, основанные на протоколе для каппинга
* [Name Generator](CupTaster/Sample/Name%20Generator.swift) - Генератор имен для образцов. (при создании n кол-ва образцов им автоматически присвоются имена A-Z, в зависимости от кол-ва, можно изменить на 1-n в настройках). На каппингах зачастую названия зерен неизвестны, поэтому записываются буквами алфавита.
* [Radar Chart](CupTaster/Sample/Radar%20Chart.swift) - Лепестковая диаграмма, с возможностью отображения текста как в сокращенном, так и в полном варианте. Сокращенный текст использует первую букву и следущую согласную (работает только с английскими буквами пока что). 
* [Evaluation](CupTaster/Sample/Evaluation) - папка со всеми способами оценки зерна
  - [Evaluation Types](CupTaster/Sample/Evaluation%20Types.swift) - Все добавленные способы ввода значений критериев оценки и их порядковый номер.
  - [Evaluation Group](CupTaster/Sample/Evaluation%20Group.swift) - Группа критериев оценки с полем для ввода заметок. При нажатии меняет внешний вид на компактный (заполненный).
  - [Evaluation Header](CupTaster/Sample/Evaluation%20Header.swift) - Верхняя часть группы критериев, которая показывает краткую информацию о введенных данных.
  - [Evaluation](CupTaster/Sample/Evaluation.swift) - Отображение способа ввода критерия оценки в зависимости от указанного способа ввода.
  - [Header Value](CupTaster/Sample/Header%20Value.swift) - Папка с отображением главного значения группы критериев оценки в зависимости от способа ввода и анимацией при указании нового значения.
    - [Slider Value](CupTaster/Sample/Slider%20Value.swift) - отображения значения для slider
    - [Radio Value](CupTaster/Sample/Radio%20Value.swift) - отображения значения для radio
    - [Checkboxes "Cups" Value](CupTaster/Sample/C%20Checkboxes%20Value.swift) - отображения значения для Checkboxes "Cups"
    - [MultiplePicker "Cups" Value](CupTaster/Sample/C%20MultiplePicker%20Value.swift) - отображения значения для MultiplePicker "Cups"
  - [Subviews](CupTaster/Sample/Subviews.swift) - Папка с отображением способов ввода значений критериев оценки.
    - [Slider](CupTaster/Sample/Slider.swift) - отображение способа ввода значения с помощью slider
    - [Radio](CupTaster/Sample/Radio.swift) - отображение способа ввода значения с помощью radio
    - [MultiplePicker](CupTaster/Sample/MultiplePicker.swift) - отображение способа ввода значения с помощью MultiplePicker
    - [Checkboxes "Cups"](CupTaster/Sample/C%20Checkboxes.swift) - отображение способа ввода значения с помощью Checkboxes "Cups"
    - [MultiplePicker "Cups"](CupTaster/Sample/C%20MultiplePicker.swift) - отображение способа ввода значения с помощью MultiplePicker "Cups"

который заполняется относительно указанного свойства evaluationType, все варианты заполнения и соответсвуйщий интерфейс рассмотрены в папке [Evaluation](https://github.com/nnnkbrrr/CupTaster/tree/main/CupTaster/Sample/Evaluation), где HeaderValues - структуры с отображением и анимациней изменения критерия оценки, SubViews - структуры с отображением способов ввода значений, а так же дополнительные файлы с отображением отдельных частей ввода значений.
